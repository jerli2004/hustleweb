<!-- templates/home.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Home - HUSTLER CURRENCY{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="container">
        <img src="https://i.pinimg.com/736x/04/29/56/04295608039211ebd9cd286193befecd.jpg" alt="Hustler Currency">
        <div class="hero-subtitle">SHIPPING ACROSS INDIA</div>

        <div class="cta-buttons">
            <a href="#products" class="btn">SHOP NOW</a>
        </div>
    </div>
</section>

<!-- Products Section -->
<section class="products-section" id="products">
    <div class="container">
        <h2 class="section-title">Our products</h2>

        <div class="products-grid">
            {% for product in products %}
            <div class="product-card">
                <div class="product-image">
                    <img src="{{ product.product_img_url }}" alt="{{ product.product_name }}">
                </div>
                <div class="product-info">
                    <h3 class="product-title">{{ product.product_name }}</h3>
                    <div class="product-price">{{ product.product_price }}</div>
                    <div class="product-actions">
                        <!-- Add to Cart Button -->
                        <a href="#" class="action-btn add-to-cart" data-product-id="{{ product.id }}"
                            onclick="addToCart(event, this)">
                            ADD TO CART
                        </a>

                        <a class="action-btn view" href="{% url 'product_detail' product.id %}">VIEW</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Add to cart functionality
  function addToCart(event, button) {
    event.preventDefault();

    const productId = button.getAttribute('data-product-id');

    $.ajax({
        url: '{% url "add_to_cart" %}',
        type: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
        },
        data: {
            productid: productId,
            quantity: 1
        },
        success: function(response) {
            if (response.success) {
                // Update cart count badge
                updateCartCount(response.total_items);

                // Show animated notification
                showCartNotification("✅ " + response.message);

                // Optional: animate the product image flying to cart
                animateProductToCart(button);
            } else {
                showCartNotification("⚠️ " + response.error, true);
            }
        },
        error: function() {
            showCartNotification("❌ Something went wrong", true);
        }
    });
}

// Show cart notification
function showCartNotification(message, isError = false) {
    const notification = document.getElementById('cartNotification');
    notification.textContent = message;
    notification.style.backgroundColor = isError ? '#f44336' : '#4caf50';
    notification.style.display = 'block';
    notification.style.opacity = 1;

    // Fade out after 2 seconds
    setTimeout(() => {
        notification.style.transition = 'opacity 0.5s';
        notification.style.opacity = 0;
        setTimeout(() => {
            notification.style.display = 'none';
            notification.style.transition = '';
        }, 500);
    }, 2000);
}

// Animate product image flying to cart
function animateProductToCart(button) {
    const productCard = button.closest('.product-card');
    const productImg = productCard.querySelector('img');
    const cartIcon = document.getElementById('cartIcon'); // your cart icon id

    if (!productImg || !cartIcon) return;

    const imgClone = productImg.cloneNode(true);
    const imgRect = productImg.getBoundingClientRect();
    const cartRect = cartIcon.getBoundingClientRect();

    imgClone.style.position = 'fixed';
    imgClone.style.left = imgRect.left + 'px';
    imgClone.style.top = imgRect.top + 'px';
    imgClone.style.width = imgRect.width + 'px';
    imgClone.style.height = imgRect.height + 'px';
    imgClone.style.transition = 'all 0.8s ease-in-out';
    imgClone.style.zIndex = 1000;
    document.body.appendChild(imgClone);

    setTimeout(() => {
        imgClone.style.left = cartRect.left + 'px';
        imgClone.style.top = cartRect.top + 'px';
        imgClone.style.width = '30px';
        imgClone.style.height = '30px';
        imgClone.style.opacity = 0.5;
    }, 10);

    setTimeout(() => {
        imgClone.remove();
    }, 800);
}

</script>
{% endblock %}