<!-- templates/checkout.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Checkout - HUSTLER CURRENCY{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-color: #000000;
        --secondary-color: #333333;
        --accent-color: #4CAF50;
        --error-color: #ff4444;
        --success-color: #4CAF50;
        --warning-color: #ff9800;
        --info-color: #2196F3;
        --light-gray: #f5f5f5;
        --medium-gray: #eeeeee;
        --dark-gray: #666666;
        --white: #ffffff;
        --border-radius: 8px;
        --box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        --transition: all 0.3s ease;
    }

    .checkout-section {
        padding: 40px 0;
        min-height: 70vh;
        background-color: var(--light-gray);
    }

    .page-title {
        font-size: 32px;
        margin-bottom: 30px;
        font-weight: 600;
        text-align: center;
        color: var(--primary-color);
        position: relative;
        padding-bottom: 15px;
    }

    .page-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 3px;
        background: var(--primary-color);
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        margin-bottom: 25px;
        color: var(--secondary-color);
        text-decoration: none;
        font-size: 15px;
        font-weight: 500;
        transition: var(--transition);
        padding: 8px 16px;
        border-radius: var(--border-radius);
        background: var(--white);
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .back-link:hover {
        color: var(--primary-color);
        text-decoration: none;
        transform: translateX(-5px);
        background: var(--medium-gray);
    }

    .back-link i {
        margin-right: 8px;
        font-size: 14px;
    }

    .checkout-layout {
        display: grid;
        grid-template-columns: 1.5fr 1fr;
        gap: 40px;
    }

    /* Checkout Form */
    .checkout-form-container {
        background: var(--white);
        padding: 40px;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        border: 1px solid var(--medium-gray);
    }

    .section-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--medium-gray);
        color: var(--primary-color);
        position: relative;
    }

    .section-title::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 60px;
        height: 2px;
        background: var(--primary-color);
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-label {
        display: block;
        margin-bottom: 10px;
        font-weight: 500;
        color: var(--secondary-color);
        font-size: 15px;
    }

    .form-control {
        width: 100%;
        padding: 14px 16px;
        border: 1px solid var(--medium-gray);
        border-radius: 6px;
        font-size: 16px;
        transition: var(--transition);
        background: var(--white);
        color: var(--secondary-color);
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0,0,0,0.1);
    }

    .form-control::placeholder {
        color: var(--dark-gray);
        opacity: 0.7;
    }

    select.form-control {
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 16px center;
        background-size: 18px;
        padding-right: 50px;
        cursor: pointer;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    /* Payment Methods */
    .payment-methods {
        margin: 30px 0;
    }

    .payment-option {
        display: flex;
        align-items: center;
        padding: 20px;
        border: 2px solid var(--medium-gray);
        border-radius: var(--border-radius);
        margin-bottom: 15px;
        cursor: pointer;
        transition: var(--transition);
        background: var(--white);
    }

    .payment-option:hover {
        border-color: var(--dark-gray);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .payment-option.selected {
        border-color: var(--primary-color);
        background-color: rgba(0,0,0,0.02);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .payment-icon {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--light-gray);
        border-radius: 8px;
        margin-right: 20px;
        font-size: 22px;
        color: var(--primary-color);
        flex-shrink: 0;
    }

    .payment-option.selected .payment-icon {
        background: var(--primary-color);
        color: var(--white);
    }

    .payment-details {
        flex: 1;
    }

    .payment-name {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--primary-color);
        font-size: 17px;
    }

    .payment-desc {
        font-size: 14px;
        color: var(--dark-gray);
        line-height: 1.4;
    }

    /* COD Info Box */
    .cod-info {
        background: #fff8e1;
        border: 1px solid #ffd54f;
        border-radius: 6px;
        padding: 20px;
        margin-top: 15px;
        display: none;
        animation: fadeIn 0.3s ease;
    }

    .cod-info.show {
        display: block;
    }

    .cod-info p {
        margin: 8px 0;
        font-size: 14px;
        line-height: 1.5;
        color: #5d4037;
    }

    .cod-info strong {
        color: #e65100;
    }

    /* Order Summary */
    .order-summary {
        background: var(--white);
        padding: 35px;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        position: sticky;
        top: 100px;
        border: 1px solid var(--medium-gray);
        height: fit-content;
    }

    .summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 18px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--medium-gray);
        align-items: flex-start;
    }

    .summary-item:last-child {
        border-bottom: none;
    }

    .summary-item div {
        flex: 1;
        padding-right: 15px;
    }

    .summary-item strong {
        display: block;
        margin-bottom: 5px;
        color: var(--primary-color);
        font-size: 16px;
    }

    .summary-item .item-details {
        font-size: 14px;
        color: var(--dark-gray);
        line-height: 1.4;
    }

    .summary-item span {
        font-weight: 500;
        color: var(--secondary-color);
        white-space: nowrap;
    }

    .summary-total {
        border-top: 2px solid var(--primary-color);
        border-bottom: none;
        font-size: 20px;
        font-weight: 700;
        padding-top: 20px;
        margin-top: 10px;
        color: var(--primary-color);
    }

    .summary-total span {
        font-size: 20px;
        font-weight: 700;
    }

    /* Checkout Button */
    .checkout-btn {
        width: 100%;
        padding: 18px;
        background-color: var(--primary-color);
        color: var(--white);
        border: none;
        border-radius: var(--border-radius);
        font-size: 17px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: var(--transition);
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }

    .checkout-btn:hover {
        background-color: var(--secondary-color);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    .checkout-btn:active {
        transform: translateY(0);
    }

    .checkout-btn:disabled {
        background-color: var(--dark-gray);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .checkout-btn i {
        font-size: 18px;
    }

    /* Error Styles */
    .form-control.error-field {
        border-color: var(--error-color);
        background-color: rgba(255, 68, 68, 0.02);
    }

    .error-message {
        color: var(--error-color);
        font-size: 13px;
        margin-top: 6px;
        display: none;
        font-weight: 500;
        padding-left: 5px;
    }

    .error-message.show {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    /* Policy Accordion */
    .policy-accordion {
        margin-top: 30px;
        border-top: 1px solid var(--medium-gray);
        padding-top: 20px;
    }

    .policy-item {
        border: 1px solid var(--medium-gray);
        border-radius: var(--border-radius);
        margin-bottom: 15px;
        overflow: hidden;
        background: var(--white);
    }

    .policy-header {
        padding: 18px 20px;
        background: var(--light-gray);
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: var(--transition);
    }

    .policy-header:hover {
        background: var(--medium-gray);
    }

    .policy-header.active {
        background: var(--primary-color);
        color: var(--white);
    }

    .policy-title {
        font-weight: 600;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .policy-icon {
        font-size: 18px;
        width: 24px;
        text-align: center;
    }

    .policy-arrow {
        transition: var(--transition);
        font-size: 14px;
    }

    .policy-header.active .policy-arrow {
        transform: rotate(180deg);
    }

    .policy-content {
        padding: 0;
        max-height: 0;
        overflow: hidden;
        transition: all 0.4s ease;
        background: var(--white);
    }

    .policy-content.active {
        padding: 20px;
        max-height: 1000px;
    }

    .policy-content ul {
        margin: 0;
        padding-left: 20px;
    }

    .policy-content li {
        margin-bottom: 10px;
        line-height: 1.6;
        color: var(--secondary-color);
    }

    .policy-content strong {
        color: var(--primary-color);
    }

    .policy-subtitle {
        font-weight: 600;
        margin: 15px 0 10px 0;
        color: var(--primary-color);
        font-size: 15px;
    }

    .policy-note {
        background: #fff8e1;
        border-left: 4px solid #ff9800;
        padding: 12px 16px;
        margin: 15px 0;
        font-size: 14px;
        color: #5d4037;
    }

    .policy-warning {
        background: #ffebee;
        border-left: 4px solid #f44336;
        padding: 12px 16px;
        margin: 15px 0;
        font-size: 14px;
        color: #b71c1c;
    }

    .policy-success {
        background: #e8f5e9;
        border-left: 4px solid #4CAF50;
        padding: 12px 16px;
        margin: 15px 0;
        font-size: 14px;
        color: #1b5e20;
    }

    /* Checkbox for terms agreement */
    .terms-agreement {
        margin-top: 20px;
        padding: 20px;
        background: #f9f9f9;
        border-radius: var(--border-radius);
        border: 1px solid var(--medium-gray);
    }

    .terms-checkbox {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        cursor: pointer;
    }

    .terms-checkbox input {
        margin-top: 4px;
        min-width: 18px;
        height: 18px;
        cursor: pointer;
    }

    .terms-checkbox label {
        cursor: pointer;
        font-size: 14px;
        line-height: 1.5;
        color: var(--secondary-color);
        flex: 1;
    }

    .terms-checkbox a {
        color: var(--primary-color);
        text-decoration: underline;
        font-weight: 500;
    }

    .terms-checkbox a:hover {
        color: var(--secondary-color);
    }

    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-5px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    /* Notification */
    .notification {
        position: fixed;
        top: 25px;
        right: 25px;
        padding: 18px 24px;
        border-radius: var(--border-radius);
        box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: space-between;
        min-width: 320px;
        max-width: 450px;
        animation: slideIn 0.4s ease;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .notification-error {
        background: linear-gradient(135deg, rgba(255, 68, 68, 0.95), rgba(220, 38, 38, 0.95));
        color: white;
        border-color: rgba(255, 255, 255, 0.2);
    }

    .notification-success {
        background: linear-gradient(135deg, rgba(76, 175, 80, 0.95), rgba(56, 142, 60, 0.95));
        color: white;
        border-color: rgba(255, 255, 255, 0.2);
    }

    .notification-info {
        background: linear-gradient(135deg, rgba(33, 150, 243, 0.95), rgba(25, 118, 210, 0.95));
        color: white;
        border-color: rgba(255, 255, 255, 0.2);
    }

    .notification button {
        background: none;
        border: none;
        color: white;
        font-size: 22px;
        cursor: pointer;
        margin-left: 20px;
        padding: 0;
        opacity: 0.8;
        transition: opacity 0.3s ease;
    }

    .notification button:hover {
        opacity: 1;
    }

    /* Footer Note */
    .footer-note {
        font-size: 13px;
        color: var(--dark-gray);
        margin-top: 25px;
        text-align: center;
        line-height: 1.6;
        padding-top: 20px;
        border-top: 1px solid var(--medium-gray);
    }

    /* Loading Spinner */
    .fa-spinner {
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* ============================
       RESPONSIVE DESIGN
       ============================ */

    /* Large Desktop (1200px and up) */
    @media (min-width: 1200px) {
        .container {
            max-width: 1140px;
        }
        
        .checkout-layout {
            gap: 50px;
        }
    }

    /* Desktop (992px to 1199px) */
    @media (max-width: 1199px) {
        .container {
            max-width: 960px;
        }
        
        .checkout-form-container,
        .order-summary {
            padding: 35px;
        }
    }

    /* Tablet (768px to 991px) */
    @media (max-width: 991px) {
        .checkout-layout {
            grid-template-columns: 1fr;
            gap: 35px;
        }
        
        .order-summary {
            position: static;
            order: -1;
        }
        
        .checkout-section {
            padding: 30px 0;
        }
        
        .page-title {
            font-size: 28px;
            margin-bottom: 25px;
        }
        
        .checkout-form-container,
        .order-summary {
            padding: 30px;
        }
        
        .section-title {
            font-size: 20px;
        }
        
        .policy-content.active {
            max-height: 1500px;
        }
    }

    /* Small Tablet (576px to 767px) */
    @media (max-width: 767px) {
        .checkout-section {
            padding: 25px 0;
        }
        
        .page-title {
            font-size: 26px;
            margin-bottom: 20px;
        }
        
        .checkout-form-container,
        .order-summary {
            padding: 25px;
        }
        
        .form-row {
            grid-template-columns: 1fr;
            gap: 0;
        }
        
        .payment-option {
            padding: 18px;
        }
        
        .payment-icon {
            width: 45px;
            height: 45px;
            margin-right: 15px;
            font-size: 20px;
        }
        
        .payment-name {
            font-size: 16px;
        }
        
        .checkout-btn {
            padding: 16px;
            font-size: 16px;
        }
        
        .notification {
            min-width: 280px;
            max-width: 350px;
            right: 15px;
            left: 15px;
            margin: 0 auto;
        }
        
        .policy-header {
            padding: 15px;
        }
        
        .policy-content.active {
            padding: 15px;
        }
    }

    /* Mobile (480px to 575px) */
    @media (max-width: 575px) {
        .checkout-section {
            padding: 20px 0;
            min-height: 60vh;
        }
        
        .page-title {
            font-size: 24px;
            margin-bottom: 15px;
            padding-bottom: 10px;
        }
        
        .back-link {
            margin-bottom: 20px;
            font-size: 14px;
            padding: 6px 12px;
        }
        
        .checkout-form-container,
        .order-summary {
            padding: 20px;
            border-radius: 6px;
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 20px;
            padding-bottom: 12px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .form-control {
            padding: 12px 14px;
            font-size: 15px;
        }
        
        select.form-control {
            padding-right: 45px;
            background-position: right 14px center;
        }
        
        .payment-methods {
            margin: 25px 0;
        }
        
        .payment-option {
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .payment-icon {
            width: 40px;
            height: 40px;
            margin-right: 12px;
            font-size: 18px;
        }
        
        .payment-name {
            font-size: 15px;
        }
        
        .payment-desc {
            font-size: 13px;
        }
        
        .summary-item {
            margin-bottom: 15px;
            padding-bottom: 12px;
        }
        
        .summary-item strong {
            font-size: 15px;
        }
        
        .summary-item .item-details {
            font-size: 13px;
        }
        
        .summary-total {
            font-size: 18px;
            padding-top: 15px;
        }
        
        .summary-total span {
            font-size: 18px;
        }
        
        .checkout-btn {
            padding: 15px;
            font-size: 15px;
            margin-top: 20px;
        }
        
        .footer-note {
            font-size: 12px;
            margin-top: 20px;
            padding-top: 15px;
        }
        
        .error-message {
            font-size: 12px;
        }
        
        .policy-title {
            font-size: 14px;
        }
        
        .policy-content li {
            font-size: 13px;
        }
    }

    /* Small Mobile (320px to 479px) */
    @media (max-width: 479px) {
        .checkout-form-container,
        .order-summary {
            padding: 18px;
            border-radius: 5px;
        }
        
        .page-title {
            font-size: 22px;
        }
        
        .section-title {
            font-size: 17px;
        }
        
        .payment-option {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .payment-icon {
            margin-right: 0;
            margin-bottom: 12px;
        }
        
        .payment-details {
            width: 100%;
        }
        
        .checkout-btn {
            padding: 14px;
            font-size: 14px;
            flex-direction: column;
            gap: 8px;
        }
        
        .checkout-btn i {
            font-size: 16px;
        }
        
        .form-control {
            padding: 11px 13px;
            font-size: 14px;
        }
        
        .notification {
            min-width: 250px;
            max-width: 300px;
            padding: 15px 20px;
            font-size: 14px;
        }
        
        .notification button {
            font-size: 20px;
            margin-left: 15px;
        }
        
        .policy-header {
            padding: 12px;
        }
        
        .policy-content.active {
            padding: 12px;
        }
    }

    /* Extra Small Mobile (under 320px) */
    @media (max-width: 319px) {
        .checkout-form-container,
        .order-summary {
            padding: 15px;
        }
        
        .page-title {
            font-size: 20px;
        }
        
        .section-title {
            font-size: 16px;
        }
        
        .form-control {
            padding: 10px 12px;
        }
        
        .checkout-btn {
            padding: 12px;
            font-size: 13px;
        }
        
        .notification {
            min-width: 220px;
            max-width: 280px;
            padding: 12px 16px;
            font-size: 13px;
        }
    }

    /* Landscape Orientation */
    @media (max-height: 600px) and (orientation: landscape) {
        .checkout-section {
            min-height: auto;
            padding: 20px 0;
        }
        
        .checkout-form-container {
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .policy-content.active {
            max-height: 300px;
            overflow-y: auto;
        }
    }

    /* Print Styles */
    @media print {
        .back-link,
        .checkout-btn,
        .payment-option {
            display: none !important;
        }
        
        .checkout-form-container,
        .order-summary {
            box-shadow: none;
            border: 1px solid #000;
        }
        
        .checkout-section {
            background: none;
        }
        
        .policy-content {
            max-height: none !important;
            padding: 15px !important;
            display: block !important;
        }
        
        .policy-header {
            pointer-events: none;
        }
    }

   
    /* FORCE LIGHT MODE ON ALL DEVICES */
.checkout-section {
    background-color: #f5f5f5 !important;
}

.checkout-form-container,
.order-summary {
    background: #ffffff !important;
    color: #000000 !important;
}

.form-control {
    background: #ffffff !important;
    color: #000000 !important;
    border-color: #eeeeee !important;
}

.form-label,
.section-title,
.page-title {
    color: #000000 !important;
}

</style>
{% endblock %}

{% block content %}
<section class="checkout-section">
    <div class="container">
        <a href="{% url 'cart' %}" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to Cart
        </a>
        
        <h1 class="page-title">Checkout</h1>
        
        <div class="checkout-layout">
            <!-- Checkout Form -->
            <div class="checkout-form-container">
                <h3 class="section-title">Shipping Information</h3>
                
                <form id="checkoutForm">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input  id="customer" type="text" class="form-control" name="customer" 
                               value="{{ request.user.get_full_name|default:'' }}" required>
                        <div class="error-message" id="customerError"></div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Phone Number *</label>
                            <input id="phone" type="tel" class="form-control" name="phone" 
                                   pattern="[0-9]{10}" title="10 digit phone number" required>
                            <div class="error-message" id="phoneError"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email Address *</label>
                            <input  id="email" type="email" class="form-control" name="email" 
                                   value="{{ request.user.email }}" required>
                            <div class="error-message" id="emailError"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Street Address *</label>
                        <input type="text" class="form-control" name="address" 
                               placeholder="House number, street name" required>
                        <div class="error-message" id="addressError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Apartment/Suite (Optional)</label>
                        <input type="text" class="form-control" name="apartment_suite" 
                               placeholder="Apartment, suite, unit, etc.">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">City *</label>
                            <input type="text" class="form-control" name="city" required>
                            <div class="error-message" id="cityError"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pin Code *</label>
                            <input type="text" class="form-control" name="pin_code" 
                                   pattern="[0-9]{6}" title="6 digit pin code" required>
                            <div class="error-message" id="pinCodeError"></div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">State *</label>
                            <select class="form-control" name="state" required>
                                <option value="">Select State</option>
                                {% for state_code, state_name in state_choices %}
                                <option value="{{ state_code }}" {% if state_code == 'TN' %}selected{% endif %}>
                                    {{ state_name }}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="error-message" id="stateError"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Country *</label>
                            <select class="form-control" name="country" required>
                                <option value="">Select Country</option>
                                {% for country_code, country_name in country_choices %}
                                <option value="{{ country_code }}" {% if country_code == 'IN' %}selected{% endif %}>
                                    {{ country_name }}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="error-message" id="countryError"></div>
                        </div>
                    </div>
                    
                    <h3 class="section-title" style="margin-top: 30px;">Payment Method</h3>
                    
                    <div class="payment-methods">
                        <div class="payment-option selected" data-method="razorpay">
                            <div class="payment-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <div class="payment-details">
                                <div class="payment-name">Pay with Razorpay</div>
                                <div class="payment-desc">Credit/Debit Card, UPI, Net Banking</div>
                            </div>
                        </div>
                        
                        <div class="payment-option" data-method="cod">
                            <div class="payment-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="payment-details">
                                <div class="payment-name">Cash on Delivery</div>
                                <div class="payment-desc">Pay 20% now, rest on delivery</div>
                            </div>
                        </div>
                        
                        <div class="cod-info" id="codInfo">
                            <p><strong>Note:</strong> For Cash on Delivery orders:</p>
                            <p>‚Ä¢ 20% advance payment is required online</p>
                            <p>‚Ä¢ Balance 80% to be paid when product is delivered</p>
                            <p>‚Ä¢ Your order will be processed after advance payment</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Order Notes (Optional)</label>
                        <textarea class="form-control" name="notes" rows="3" 
                                  placeholder="Any special instructions for your order..."></textarea>
                    </div>
                    
                    <!-- Terms Agreement -->
                    <div class="terms-agreement">
                        <div class="terms-checkbox">
                            <input type="checkbox" id="agreeTerms" name="agree_terms" required>
                            <label for="agreeTerms">
                                I agree to the <a href="javascript:void(0)" onclick="openPolicy('privacy')">Privacy Policy</a>, 
                                <a href="javascript:void(0)" onclick="openPolicy('terms')">Terms & Conditions</a>, 
                                <a href="javascript:void(0)" onclick="openPolicy('refund')">Refund & Return Policy</a>, 
                                <a href="javascript:void(0)" onclick="openPolicy('shipping')">Shipping Policy</a>, and 
                                <a href="javascript:void(0)" onclick="openPolicy('cancellation')">Cancellation Policy</a>
                            </label>
                        </div>
                    </div>
                    
                    <input type="hidden" name="payment_method" id="paymentMethod" value="razorpay">
                </form>
                
                <!-- Policy Accordion -->
                <div class="policy-accordion">
                    <div class="policy-item">
                        <div class="policy-header" onclick="togglePolicy('privacy')">
                            <div class="policy-title">
                                <i class="fas fa-shield-alt policy-icon"></i>
                                Privacy Policy
                            </div>
                            <i class="fas fa-chevron-down policy-arrow"></i>
                        </div>
                        <div class="policy-content" id="privacyContent">
                            <p><strong>Last updated:</strong> {{ current_date }}</p>
                            
                            <div class="policy-subtitle">üìå Information we collect</div>
                            <p>Hustler Currency values your privacy. We collect:</p>
                            <ul>
                                <li>Name</li>
                                <li>Mobile number</li>
                                <li>Email address</li>
                                <li>Shipping address</li>
                                <li>Payment details (processed securely via payment gateways)</li>
                            </ul>
                            <div class="policy-note">
                                <strong>Note:</strong> We do NOT store your card or UPI details.
                            </div>
                            
                            <div class="policy-subtitle">üìå How we use your information</div>
                            <ul>
                                <li>To process and deliver your orders</li>
                                <li>To contact you regarding order updates</li>
                                <li>To improve our website and customer experience</li>
                            </ul>
                            
                            <div class="policy-subtitle">üìå Data protection</div>
                            <p>Your personal data is stored securely and is never sold or shared with third parties, except delivery partners and payment gateways for order fulfillment.</p>
                            
                            <div class="policy-subtitle">üìå Cookies</div>
                            <p>Our website may use cookies to enhance browsing experience.</p>
                            
                            <p>By using our website, you agree to this Privacy Policy.</p>
                        </div>
                    </div>
                    
                    <div class="policy-item">
                        <div class="policy-header" onclick="togglePolicy('terms')">
                            <div class="policy-title">
                                <i class="fas fa-file-contract policy-icon"></i>
                                Terms & Conditions
                            </div>
                            <i class="fas fa-chevron-down policy-arrow"></i>
                        </div>
                        <div class="policy-content" id="termsContent">
                            <p>By accessing and using this website, you agree to the following terms:</p>
                            
                            <div class="policy-subtitle">‚úî Product Information</div>
                            <ul>
                                <li>All products sold are motivational wall frames for decorative purposes.</li>
                                <li>Colors may slightly vary due to screen resolution.</li>
                            </ul>
                            
                            <div class="policy-subtitle">‚úî Pricing</div>
                            <ul>
                                <li>Prices are subject to change without prior notice.</li>
                                <li>Any offers or discounts are time-limited.</li>
                            </ul>
                            
                            <div class="policy-subtitle">‚úî Usage</div>
                            <ul>
                                <li>Content, images, and designs on this website are the property of Hustler Currency.</li>
                                <li>Reproduction or misuse is strictly prohibited.</li>
                            </ul>
                            
                            <div class="policy-subtitle">‚úî Order Acceptance</div>
                            <p>We reserve the right to cancel any order due to:</p>
                            <ul>
                                <li>Incorrect pricing</li>
                                <li>Address issues</li>
                                <li>Stock unavailability</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="policy-item">
                        <div class="policy-header" onclick="togglePolicy('refund')">
                            <div class="policy-title">
                                <i class="fas fa-exchange-alt policy-icon"></i>
                                Refund & Return Policy
                            </div>
                            <i class="fas fa-chevron-down policy-arrow"></i>
                        </div>
                        <div class="policy-content" id="refundContent">
                            <p>We follow a limited return policy due to the fragile nature of wall frames.</p>
                            
                            <div class="policy-subtitle">‚úî Returns accepted only if:</div>
                            <ul>
                                <li>Product received is damaged</li>
                                <li>Wrong product delivered</li>
                            </ul>
                            
                            <div class="policy-subtitle">‚ùå Returns NOT accepted for:</div>
                            <ul>
                                <li>Change of mind</li>
                                <li>Minor color variation</li>
                                <li>Improper handling after delivery</li>
                            </ul>
                            
                            <div class="policy-subtitle">üì¶ Return process</div>
                            <ul>
                                <li>Customer must contact us within 24 hours of delivery</li>
                                <li>Unboxing video is mandatory for damage claims</li>
                                <li>Replacement will be processed after verification</li>
                            </ul>
                            
                            <div class="policy-warning">
                                üö´ Refunds are not applicable for successfully delivered and undamaged products.
                            </div>
                        </div>
                    </div>
                    
                    <div class="policy-item">
                        <div class="policy-header" onclick="togglePolicy('shipping')">
                            <div class="policy-title">
                                <i class="fas fa-shipping-fast policy-icon"></i>
                                Shipping Policy
                            </div>
                            <i class="fas fa-chevron-down policy-arrow"></i>
                        </div>
                        <div class="policy-content" id="shippingContent">
                            <div class="policy-subtitle">‚úî Delivery Time</div>
                            <ul>
                                <li>Orders are processed within 1‚Äì2 working days</li>
                                <li>Delivery time: 3‚Äì7 working days depending on location</li>
                            </ul>
                            
                            <div class="policy-subtitle">‚úî Shipping Partners</div>
                            <p>We ship through reliable courier partners across India.</p>
                            
                            <div class="policy-subtitle">‚úî Shipping Charges</div>
                            <ul>
                                <li>Shipping charges (if any) will be clearly shown at checkout.</li>
                            </ul>
                            
                            <div class="policy-subtitle">‚úî Tracking</div>
                            <p>Tracking details will be shared via SMS / WhatsApp after dispatch.</p>
                        </div>
                    </div>
                    
                    <div class="policy-item">
                        <div class="policy-header" onclick="togglePolicy('cancellation')">
                            <div class="policy-title">
                                <i class="fas fa-ban policy-icon"></i>
                                Cancellation Policy
                            </div>
                            <i class="fas fa-chevron-down policy-arrow"></i>
                        </div>
                        <div class="policy-content" id="cancellationContent">
                            <div class="policy-subtitle">‚úî Order Cancellation</div>
                            <ul>
                                <li>Orders can be cancelled within 12 hours of placing the order.</li>
                                <li>Once the order is shipped, cancellation is not possible.</li>
                            </ul>
                            
                            <div class="policy-subtitle">‚úî COD Orders</div>
                            <ul>
                                <li>Fake or repeated COD order cancellations may lead to blacklisting.</li>
                            </ul>
                            
                            <div class="policy-subtitle">For cancellation requests, contact:</div>
                            <div class="policy-success">
                                üì≤ +91 80156 12030
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Order Summary -->
            <div class="order-summary">
                <h3 class="section-title">Order Summary</h3>
                
                {% for item in cart_items %}
                <div class="summary-item">
                    <div>
                        <strong>{{ item.name }}</strong>
                        <div class="item-details">
                            Qty: {{ item.quantity }} √ó ‚Çπ{{ item.price|floatformat:2 }}
                        </div>
                    </div>
                    <span>‚Çπ{{ item.item_total|floatformat:2 }}</span>
                </div>
                {% endfor %}
                
                <div class="summary-item">
                    <span>Subtotal</span>
                    <span>‚Çπ{{ subtotal|floatformat:2 }}</span>
                </div>
                
                <div class="summary-item">
                    <span>Shipping</span>
                    <span style="color: var(--accent-color);">FREE</span>
                </div>
                
                <div class="summary-item summary-total">
                    <span>Total</span>
                    <span>‚Çπ{{ total|floatformat:2 }}</span>
                </div>
                
                <div class="summary-item" id="codAdvance" style="display: none;">
                    <span>COD Advance (20%)</span>
                    <span id="codAdvanceAmount">‚Çπ0.00</span>
                </div>
                
                <button class="checkout-btn" id="proceedToPay">
                    <i class="fas fa-lock"></i>
                    Proceed to Payment
                </button>
                
                <p class="footer-note">
                    Your personal data will be used to process your order and support your experience.
                </p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<!-- Add Razorpay Checkout Script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const paymentOptions = document.querySelectorAll('.payment-option');
        const paymentMethodInput = document.getElementById('paymentMethod');
        const codInfo = document.getElementById('codInfo');
        const codAdvance = document.getElementById('codAdvance');
        const codAdvanceAmount = document.getElementById('codAdvanceAmount');
        const proceedBtn = document.getElementById('proceedToPay');
        const checkoutForm = document.getElementById('checkoutForm');
        const agreeTermsCheckbox = document.getElementById('agreeTerms');
        
        // Policy accordion functionality
        function togglePolicy(policyId) {
            const content = document.getElementById(policyId + 'Content');
            const header = content.previousElementSibling;
            const arrow = header.querySelector('.policy-arrow');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                header.classList.remove('active');
                arrow.style.transform = 'rotate(0deg)';
            } else {
                // Close all other policies
                document.querySelectorAll('.policy-content').forEach(policy => {
                    policy.classList.remove('active');
                    policy.previousElementSibling.classList.remove('active');
                    policy.previousElementSibling.querySelector('.policy-arrow').style.transform = 'rotate(0deg)';
                });
                
                // Open selected policy
                content.classList.add('active');
                header.classList.add('active');
                arrow.style.transform = 'rotate(180deg)';
                
                // Scroll to policy if on mobile
                if (window.innerWidth < 768) {
                    content.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }
        
        // Open specific policy from terms agreement links
        function openPolicy(policyId) {
            togglePolicy(policyId);
            
            // Check the terms checkbox
            agreeTermsCheckbox.checked = true;
            
            // Scroll to the policy section
            const policyElement = document.getElementById(policyId + 'Content');
            policyElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Attach global functions
        window.togglePolicy = togglePolicy;
        window.openPolicy = openPolicy;
        
        // Payment method selection
        paymentOptions.forEach(option => {
            option.addEventListener('click', function() {
                paymentOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                
                const method = this.getAttribute('data-method');
                paymentMethodInput.value = method;
                
                if (method === 'cod') {
                    codInfo.classList.add('show');
                    codAdvance.style.display = 'flex';
                    
                    // Calculate 20% advance
                    const total = {{ total|default:0 }};
                    const advanceAmount = total * 0.2;
                    codAdvanceAmount.textContent = '‚Çπ' + advanceAmount.toFixed(2);
                    
                    proceedBtn.innerHTML = '<i class="fas fa-money-bill-wave"></i> Pay 20% Advance Now';
                } else {
                    codInfo.classList.remove('show');
                    codAdvance.style.display = 'none';
                    proceedBtn.innerHTML = '<i class="fas fa-lock"></i> Pay Full Amount';
                }
            });
        });
        
        // Form validation
        function validateForm() {
            let isValid = true;
            const requiredFields = [
                { name: 'customer', errorId: 'customerError', message: 'Full name is required' },
                { name: 'phone', errorId: 'phoneError', message: 'Valid phone number is required (10 digits)' },
                { name: 'email', errorId: 'emailError', message: 'Valid email is required' },
                { name: 'address', errorId: 'addressError', message: 'Street address is required' },
                { name: 'city', errorId: 'cityError', message: 'City is required' },
                { name: 'pin_code', errorId: 'pinCodeError', message: 'Valid pin code is required (6 digits)' },
                { name: 'state', errorId: 'stateError', message: 'State is required' },
                { name: 'country', errorId: 'countryError', message: 'Country is required' }
            ];
            
            // Check terms agreement
            if (!agreeTermsCheckbox.checked) {
                showNotification('Please agree to the terms and policies to proceed', 'error');
                agreeTermsCheckbox.focus();
                return false;
            }
            
            // Clear previous errors
            requiredFields.forEach(field => {
                const errorEl = document.getElementById(field.errorId);
                errorEl.classList.remove('show');
                const inputEl = checkoutForm.querySelector(`[name="${field.name}"]`);
                inputEl.classList.remove('error-field');
            });
            
            // Validate each field
            requiredFields.forEach(field => {
                const inputEl = checkoutForm.querySelector(`[name="${field.name}"]`);
                const value = inputEl.value.trim();
                
                if (!value) {
                    showError(field.name, field.message);
                    isValid = false;
                } else if (field.name === 'phone' && !/^[0-9]{10}$/.test(value)) {
                    showError(field.name, 'Please enter a valid 10-digit phone number');
                    isValid = false;
                } else if (field.name === 'email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
                    showError(field.name, 'Please enter a valid email address');
                    isValid = false;
                } else if (field.name === 'pin_code' && !/^[0-9]{6}$/.test(value)) {
                    showError(field.name, 'Please enter a valid 6-digit pin code');
                    isValid = false;
                }
            });
            
            return isValid;
        }
        
        function showError(fieldName, message) {
            const inputEl = checkoutForm.querySelector(`[name="${fieldName}"]`);
            const errorId = `${fieldName}Error`;
            const errorEl = document.getElementById(errorId);
            
            inputEl.classList.add('error-field');
            errorEl.textContent = message;
            errorEl.classList.add('show');
            
            // Focus on first error field
            if (!checkoutForm.querySelector('.error-field:focus')) {
                inputEl.focus();
            }
        }
        
        // Clear errors on input
        checkoutForm.querySelectorAll('input, select, textarea').forEach(field => {
            field.addEventListener('input', function() {
                this.classList.remove('error-field');
                const fieldName = this.getAttribute('name');
                if (fieldName) {
                    const errorEl = document.getElementById(`${fieldName}Error`);
                    if (errorEl) errorEl.classList.remove('show');
                }
            });
        });
        
        // Proceed to payment button click
        proceedBtn.addEventListener('click', function() {
            if (!validateForm()) {
                return;
            }
            
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            this.disabled = true;
            
            // Submit form via AJAX
            const formData = new FormData(checkoutForm);
            
            fetch('{% url "checkout" %}', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Open Razorpay payment
                    openRazorpayPayment(data);
                } else {
                    if (data.errors) {
                        Object.keys(data.errors).forEach(field => {
                            showError(field, data.errors[field][0]);
                        });
                    } else {
                        showNotification(data.error || 'Something went wrong', 'error');
                    }
                    proceedBtn.innerHTML = originalText;
                    proceedBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Failed to process checkout', 'error');
                proceedBtn.innerHTML = originalText;
                proceedBtn.disabled = false;
            });
        });
        
        // Open Razorpay payment

        function openRazorpayPayment(data) {
    const isCOD = data.payment_method === 'cod';

    const options = {
        key: data.razorpay_key,
        amount: data.amount,
        currency: 'INR',
        name: 'HUSTLER CURRENCY',
        description: isCOD
            ? '20% Advance Payment for COD Order'
            : 'Full Payment for Your Order',
        order_id: data.razorpay_order_id,

        handler: function (response) {
            verifyPayment(response, data.order_id);
        },

        prefill: {
            name: document.getElementById('customer').value,
            email: document.getElementById('email').value,
            contact: document.getElementById('phone').value
        },

        theme: {
            color: '#000000'
        },

        modal: {
            ondismiss: function () {
                showNotification('Payment cancelled', 'info');
                proceedBtn.disabled = false;
            }
        }
    };

    const rzp = new Razorpay(options);
    rzp.open();
}

        // Verify payment with server
        function verifyPayment(paymentResponse, orderId) {
            fetch('{% url "verify_payment" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify({
                    razorpay_order_id: paymentResponse.razorpay_order_id,
                    razorpay_payment_id: paymentResponse.razorpay_payment_id,
                    razorpay_signature: paymentResponse.razorpay_signature,
                    order_id: orderId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(data.message, 'success');
                    // Redirect to order success page
                    setTimeout(() => {
                        window.location.href = data.redirect_url;
                    }, 2000);
                } else {
                    showNotification(data.error || 'Payment verification failed', 'error');
                    proceedBtn.innerHTML = '<i class="fas fa-lock"></i> ' + 
                        (data.payment_method === 'cod' ? 'Pay 20% Advance Now' : 'Pay Full Amount');
                    proceedBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Payment verification failed', 'error');
                proceedBtn.innerHTML = '<i class="fas fa-lock"></i> Proceed to Payment';
                proceedBtn.disabled = false;
            });
        }
        
        // Notification function
        function showNotification(message, type) {
            // Remove existing notifications
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // Create notification
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div>${message}</div>
                <button onclick="this.parentElement.remove()">√ó</button>
            `;
            
            // Add styles
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'error' ? '#ff4444' : type === 'success' ? '#4CAF50' : '#2196F3'};
                color: white;
                padding: 15px 20px;
                border-radius: 4px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: space-between;
                min-width: 300px;
                max-width: 400px;
                animation: slideIn 0.3s ease;
            `;
            
            notification.querySelector('button').style.cssText = `
                background: none;
                border: none;
                color: white;
                font-size: 24px;
                cursor: pointer;
                margin-left: 20px;
                padding: 0;
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Add CSS for animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    });
</script>
{% endblock %}